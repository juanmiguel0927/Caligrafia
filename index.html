<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Entrenador Caligraf√≠a v24</title>
    
    <!-- FUENTES -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* =========================================
           ESTILOS DE IMPRESI√ìN (PDF FIX)
           ========================================= */
        @media print {
            @page {
                size: letter;
                margin: 0; /* Sin m√°rgenes del navegador */
            }

            /* Ocultar TODO lo que no sea la hoja */
            body * {
                visibility: hidden;
            }

            /* Hacer visible solo la hoja y su contenido */
            #sheet, #sheet * {
                visibility: visible;
            }

            /* Posicionar la hoja para cubrir toda la p√°gina impresa */
            #sheet {
                position: fixed;
                left: 0;
                top: 0;
                width: 8.5in !important;
                height: 11in !important;
                margin: 0 !important;
                padding: 0.5in 0.7in !important; /* M√°rgenes internos del papel */
                
                /* Forzar apariencia de papel */
                background-color: white !important;
                box-shadow: none !important;
                z-index: 99999;
                
                /* Evitar hoja 2 */
                overflow: hidden !important;
                max-height: 100vh !important;
                page-break-after: avoid !important;
            }

            /* Forzar impresi√≥n de colores de fondo (l√≠neas) */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* Ocultar botones y scrollbars */
            ::-webkit-scrollbar { display: none; }
        }

        /* --- ESTILOS DE PANTALLA --- */
        body { 
            background-color: #111827; /* Fondo oscuro app */
            color: #e5e7eb;
        }

        /* HOJA CARTA (Vista Pantalla) */
        .sheet {
            width: 8.5in;
            height: 11in;
            background-color: white;
            position: relative;
            padding: 0.5in 0.7in;
            box-sizing: border-box;
            margin: 0 auto;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            color: black; /* Texto negro por defecto en la hoja */
        }

        /* PATRONES DE FONDO */
        .pattern-montessori {
            background-image: repeating-linear-gradient(to bottom, transparent 0px, transparent 19px, #bfdbfe 20px, transparent 21px, transparent 39px, #bfdbfe 40px, transparent 41px, transparent 59px, #e5e7eb 60px);
            background-size: 100% 60px;
            background-attachment: local;
        }
        .pattern-double {
            background-image: repeating-linear-gradient(to bottom, transparent 0px, transparent 24px, #93c5fd 25px, transparent 26px, transparent 34px, #93c5fd 35px, transparent 36px, transparent 59px, #e5e7eb 60px);
            background-size: 100% 60px;
            background-attachment: local;
        }
        .pattern-lines {
            background-image: repeating-linear-gradient(to bottom, transparent 0px, transparent 59px, #9ca3af 60px);
            background-size: 100% 60px;
            background-attachment: local;
        }
        .pattern-grid {
            background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            background-attachment: local;
        }

        /* RENGLONES */
        #linesContainer { flex-grow: 1; width: 100%; position: relative; }
        .text-row { width: 100%; height: 60px; line-height: 60px; display: block; box-sizing: border-box; padding-top: 10px; white-space: nowrap; overflow: hidden; }
        .font-cursive { font-family: 'Dancing Script', cursive; padding-left: 8px; }
        .font-print { font-family: 'Lexend', sans-serif; letter-spacing: 1px; }

        /* SVG */
        .svg-row { height: 60px; width: 100%; overflow: hidden; display: flex; align-items: flex-end; }
        .svg-pattern { width: 100%; height: 60px; display: block; -webkit-mask-repeat: repeat-x; mask-repeat: repeat-x; -webkit-mask-position: bottom left; mask-position: bottom left; background-color: currentColor; }

        /* DEFINICIONES SVG */
        .p-verticals { -webkit-mask-size: 15px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='15' height='60' viewBox='0 0 15 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='7.5' y1='15' x2='7.5' y2='45' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-slanted { -webkit-mask-size: 15px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='15' height='60' viewBox='0 0 15 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='12' y1='15' x2='3' y2='45' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-dash { -webkit-mask-size: 25px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='25' height='60' viewBox='0 0 25 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='2' y1='30' x2='23' y2='30' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-square { -webkit-mask-size: 30px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='30' height='60' viewBox='0 0 30 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,45 L0,20 L15,20 L15,45 L30,45' fill='none' stroke='black' stroke-width='1.5' stroke-linejoin='round'/%3E%3C/svg%3E"); }
        .p-zig { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,45 L10,15 L20,45' fill='none' stroke='black' stroke-width='1.5' stroke-linejoin='round'/%3E%3C/svg%3E"); }
        .p-u { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2,20 Q10,55 18,20' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-arch { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2,45 Q10,10 18,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-c { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18,20 Q2,32.5 18,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-c-rev { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2,20 Q18,32.5 2,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-circle { -webkit-mask-size: 25px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='25' height='60' viewBox='0 0 25 60' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='12.5' cy='32.5' r='8' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-l { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5,15 L5,40 Q5,45 15,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-j { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15,20 L15,45 Q15,55 5,50' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-e { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,45 Q5,45 5,35 Q5,25 10,25 Q15,25 15,35 Q15,45 20,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-loop-l { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,45 Q10,45 10,10 Q10,10 20,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-waves { -webkit-mask-size: 30px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='30' height='60' viewBox='0 0 30 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,35 Q7.5,20 15,35 T30,35' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-spring { -webkit-mask-size: 15px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='15' height='60' viewBox='0 0 15 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,40 Q7.5,10 15,40' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-swirl { -webkit-mask-size: 40px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='40' height='60' viewBox='0 0 40 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5,40 C5,25 35,25 35,40 C35,50 15,50 15,35 C15,30 25,30 25,35' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-diamonds { -webkit-mask-size: 30px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='30' height='60' viewBox='0 0 30 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,32.5 L15,15 L30,32.5 L15,50 L0,32.5' fill='none' stroke='black' stroke-width='1.5' stroke-linejoin='round'/%3E%3C/svg%3E"); }

        /* UI */
        .btn-exercise { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; padding: 4px; height: 50px; transition: all 0.2s; border-radius: 6px; }
        .btn-preview { width: 100%; height: 25px; display: block; -webkit-mask-repeat: repeat-x; mask-repeat: repeat-x; -webkit-mask-position: center; mask-position: center; background-color: #e5e7eb; margin-bottom: 2px; }
        details > summary { list-style: none; cursor: pointer; }
        
        /* Ajustes Mobile */
        @media (max-width: 768px) {
            .sheet { min-width: 8.5in; }
            #previewContainer { height: calc(100vh - 80px); background: #111827; padding: 10px; display: block; overflow: auto; -webkit-overflow-scrolling: touch; }
            #panelConfig { background-color: #0f172a; color: white; } 
        }
        @media (min-width: 769px) {
            #mobileTabs { display: none; }
            #panelConfig { display: flex !important; }
            #panelPreview { display: flex !important; }
        }
    </style>
</head>
<body class="bg-gray-900 h-screen overflow-hidden flex flex-col md:flex-row font-sans text-gray-100">

    <!-- PANEL LATERAL -->
    <aside id="panelConfig" class="w-full md:w-[420px] bg-gray-900 shadow-xl z-20 flex flex-col h-full md:h-screen overflow-y-auto border-r border-gray-700 hidden md:flex relative">
        <div class="p-4 space-y-4 pb-24 md:pb-5">
            <div class="border-b border-gray-700 pb-2 flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold text-blue-400">‚úçÔ∏è Caligraf√≠a Pro</h2>
                    <p class="text-[10px] text-gray-400">by Juan Miguel Rios Redondo</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="window.location.reload()" class="text-xs bg-blue-900/50 hover:bg-blue-800 text-blue-200 px-3 py-1 rounded border border-blue-800 flex items-center gap-1">üîÑ <span class="hidden md:inline">Reload</span></button>
                    <button onclick="resetAll()" class="text-xs bg-red-900/50 hover:bg-red-800 text-red-200 px-3 py-1 rounded border border-red-800">Borrar</button>
                </div>
            </div>

            <div class="bg-gray-800 p-2 rounded border border-gray-600 flex justify-between items-center">
                <span class="text-xs font-bold text-gray-300 uppercase">Ocupaci√≥n Hoja:</span>
                <span id="lineCounter" class="text-xs font-mono font-bold text-green-400">0 / 13</span>
            </div>

            <!-- GENERADORES -->
            <div class="bg-gray-800 p-3 rounded-lg border border-gray-700">
                <label class="text-[10px] text-gray-400 uppercase font-bold block mb-2">Generar Rutina</label>
                <div class="grid grid-cols-5 gap-2">
                    <button onclick="fillPage('rectos')" class="flex flex-col items-center justify-center p-2 bg-blue-900/30 hover:bg-blue-800 border border-blue-800 rounded"><span class="text-lg">üìè</span><span class="text-[9px] mt-1 text-blue-200">Rectos</span></button>
                    <button onclick="fillPage('curvas')" class="flex flex-col items-center justify-center p-2 bg-green-900/30 hover:bg-green-800 border border-green-800 rounded"><span class="text-lg">d o</span><span class="text-[9px] mt-1 text-green-200">Curvas</span></button>
                    <button onclick="fillPage('bucles')" class="flex flex-col items-center justify-center p-2 bg-orange-900/30 hover:bg-orange-800 border border-orange-800 rounded"><span class="text-lg">‚û∞</span><span class="text-[9px] mt-1 text-orange-200">Bucles</span></button>
                    <button onclick="fillPage('mix')" class="flex flex-col items-center justify-center p-2 bg-purple-900/30 hover:bg-purple-800 border border-purple-800 rounded"><span class="text-lg">üîÄ</span><span class="text-[9px] mt-1 text-purple-200">Mix</span></button>
                    <button onclick="fillPage('texto')" class="flex flex-col items-center justify-center p-2 bg-gray-700 hover:bg-gray-600 border border-gray-600 rounded"><span class="text-lg">üìù</span><span class="text-[9px] mt-1 text-gray-200">Texto</span></button>
                </div>
            </div>

            <!-- MANUALES -->
            <details class="group bg-gray-800 rounded-lg border border-gray-700"><summary class="p-2 font-bold text-[10px] uppercase text-blue-300 hover:bg-gray-700 flex justify-between select-none">1. Trazos Rectos<span class="transform group-open:rotate-180">‚ñº</span></summary><div class="p-2 grid grid-cols-4 gap-2 bg-gray-900/50"><button onclick="addGraphic('{{VERT}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-verticals"></span>||||</button><button onclick="addGraphic('{{INCL}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-slanted"></span>////</button><button onclick="addGraphic('{{GUION}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-dash"></span>----</button><button onclick="addGraphic('{{ALMENA}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-square"></span>Castillo</button><button onclick="addGraphic('{{ZIGZAG}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-zig"></span>ZigZag</button><button onclick="addGraphic('{{L_SHAPE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-l"></span>L L L</button></div></details>
            <details class="group bg-gray-800 rounded-lg border border-gray-700"><summary class="p-2 font-bold text-[10px] uppercase text-green-300 hover:bg-gray-700 flex justify-between select-none">2. Curvas<span class="transform group-open:rotate-180">‚ñº</span></summary><div class="p-2 grid grid-cols-4 gap-2 bg-gray-900/50"><button onclick="addGraphic('{{U_SHAPE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-u"></span>U U U</button><button onclick="addGraphic('{{ARCH}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-arch"></span>Arcos</button><button onclick="addGraphic('{{C_SHAPE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-c"></span>C C C</button><button onclick="addGraphic('{{C_REV}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-c-rev"></span>C Inv.</button><button onclick="addGraphic('{{CIRCLE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-circle"></span>ooo</button><button onclick="addGraphic('{{J_HOOK}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-j"></span>J J J</button></div></details>
            <details class="group bg-gray-800 rounded-lg border border-gray-700"><summary class="p-2 font-bold text-[10px] uppercase text-orange-300 hover:bg-gray-700 flex justify-between select-none">3. Bucles<span class="transform group-open:rotate-180">‚ñº</span></summary><div class="p-2 grid grid-cols-4 gap-2 bg-gray-900/50"><button onclick="addGraphic('{{BUCLE_E}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-e"></span>elelel</button><button onclick="addGraphic('{{BUCLE_L}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-loop-l"></span>Alto</button><button onclick="addGraphic('{{OLAS}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-waves"></span>Olas</button><button onclick="addGraphic('{{MUELLE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-spring"></span>Muelle</button><button onclick="addGraphic('{{ESPIRAL}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-swirl"></span>Espiral</button><button onclick="addGraphic('{{ROMBOS}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-diamonds"></span>Rombos</button></div></details>

            <!-- INPUT -->
            <div>
                 <textarea id="inputText" rows="2" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none font-mono text-gray-200" placeholder="Escribe aqu√≠..."></textarea>
                 <button onclick="fillRemaining()" class="w-full mt-2 text-xs bg-indigo-700 hover:bg-indigo-600 text-white p-2 rounded font-bold transition">‚ú® Rellenar Espacio Restante</button>
            </div>

            <!-- CONTROLES -->
            <div class="bg-gray-800 p-3 rounded-lg border border-gray-700 space-y-3">
                <div class="grid grid-cols-3 gap-1 text-[10px]">
                    <label class="flex items-center cursor-pointer"><input type="radio" name="practiceMode" value="simple" checked onchange="render()" class="accent-blue-500 mr-1"> Simple</label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="practiceMode" value="plana" onchange="render()" class="accent-blue-500 mr-1"> Alterno</label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="practiceMode" value="progressive" onchange="render()" class="accent-blue-500 mr-1"> Progresivo</label>
                </div>
                
                <div class="flex gap-2">
                    <input type="text" id="schoolName" placeholder="Colegio" class="w-1/2 bg-gray-900 border border-gray-600 text-gray-300 text-[10px] rounded p-1">
                    <input type="text" id="studentName" placeholder="Alumno" class="w-1/2 bg-gray-900 border border-gray-600 text-gray-300 text-[10px] rounded p-1">
                </div>

                <div class="flex gap-2 justify-center pt-2 border-t border-gray-700">
                    <button onclick="setColor('black')" class="w-5 h-5 rounded-full bg-black border border-gray-500"></button>
                    <button onclick="setColor('#2563eb')" class="w-5 h-5 rounded-full bg-blue-600 border border-gray-500"></button>
                    <button onclick="setColor('#dc2626')" class="w-5 h-5 rounded-full bg-red-600 border border-gray-500"></button>
                    <button onclick="setColor('#9ca3af')" class="w-5 h-5 rounded-full bg-gray-400 border border-gray-500"></button>
                </div>

                <div class="grid grid-cols-2 gap-2 border-t border-gray-700 pt-2">
                    <div>
                        <div class="flex justify-between mb-1"><label class="text-[10px] uppercase font-bold text-gray-400">Opacidad</label><span id="opacityVal" class="text-[9px] font-mono text-blue-300">30%</span></div>
                        <input type="range" id="opacityRange" min="10" max="100" value="30" class="w-full h-1 bg-gray-600 rounded accent-blue-400">
                    </div>
                    <div>
                        <div class="flex justify-between mb-1"><label class="text-[10px] uppercase font-bold text-gray-400">Tama√±o</label><span id="sizeVal" class="text-[9px] font-mono text-blue-300">30px</span></div>
                        <input type="range" id="sizeRange" min="16" max="80" value="30" class="w-full h-1 bg-gray-600 rounded accent-blue-400">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2">
                     <div>
                        <label class="text-[10px] uppercase font-bold text-gray-400 mb-1 block">Papel</label>
                        <select id="paperSelect" class="w-full bg-gray-900 border border-gray-600 text-gray-300 rounded p-1 text-[10px]">
                            <option value="pattern-montessori">Montessori</option>
                            <option value="pattern-double">Doble Rayada</option>
                            <option value="pattern-lines">Rayado</option>
                            <option value="pattern-grid">Cuadr√≠cula</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-400 mb-1 block">Fuente</label>
                        <select id="fontSelect" class="w-full bg-gray-900 border border-gray-600 text-gray-300 rounded p-1 text-[10px]">
                            <option value="font-cursive">Cursiva</option>
                            <option value="font-print">Imprenta</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="text-center pt-2 border-t border-gray-700">
                <p class="text-[10px] text-gray-500">Desarrollado por <strong class="text-gray-400">Juan Miguel Rios Redondo</strong></p>
            </div>
        </div>
    </aside>

    <!-- PREVIEW AREA -->
    <main id="panelPreview" class="flex-1 bg-gray-800 h-full overflow-hidden flex flex-col relative hidden md:flex">
        <div class="md:hidden bg-gray-900 text-white p-2 text-center text-xs font-bold uppercase tracking-widest shadow z-10 flex justify-between items-center px-4">
            <span>Vista Previa</span>
            <button onclick="window.location.reload()" class="text-xs bg-gray-800 hover:bg-gray-700 p-1 rounded border border-gray-600">üîÑ</button>
        </div>

        <div id="previewContainer" class="flex-1 w-full flex justify-center p-0 md:p-8 overflow-auto">
            <div id="sheet" class="sheet pattern-montessori shadow-2xl origin-top">
                <div class="flex-grow flex flex-col h-full">
                    <div class="flex flex-col items-center border-b-2 border-gray-800 pb-2 mb-0 h-[25mm] justify-end flex-shrink-0">
                        <h1 id="headerTitleDisplay" class="text-xl font-bold text-gray-800 uppercase tracking-wide font-sans w-full text-center">Caligraf√≠a</h1>
                        <div class="w-full flex justify-between text-sm text-gray-500 mt-1 font-mono">
                            <span id="studentNameDisplay">Alumno: _________________</span>
                            <span>Fecha: _______</span>
                        </div>
                    </div>
                    <div id="linesContainer" class="w-full relative flex-grow"></div>
                </div>
                <div class="mt-auto pt-1 border-t border-gray-300 text-center flex-shrink-0">
                    <p class="text-[8px] text-gray-400 font-sans">Material educativo creado con el Entrenador de Caligraf√≠a de Juan Miguel Rios Redondo</p>
                </div>
            </div>
        </div>
        <button id="printFloatBtn" onclick="window.print()" class="absolute bottom-24 right-6 md:bottom-10 md:right-10 bg-blue-600 text-white p-4 rounded-full shadow-lg z-50 hover:bg-blue-500 transition-all transform hover:scale-110 border-2 border-white">üñ®Ô∏è</button>
    </main>

    <!-- TABS M√ìVIL -->
    <nav id="mobileTabs" class="fixed bottom-0 w-full bg-gray-900 border-t border-gray-800 flex justify-around py-2 z-50 shadow-lg md:hidden h-16">
        <button onclick="switchTab('config')" id="tabConfig" class="flex flex-col items-center justify-center text-blue-400 w-1/2"><span class="text-xl mb-1">üõ†Ô∏è</span><span class="text-[10px] font-bold">EDITOR</span></button>
        <button onclick="switchTab('preview')" id="tabPreview" class="flex flex-col items-center justify-center text-gray-400 w-1/2"><span class="text-xl mb-1">üìÑ</span><span class="text-[10px] font-bold">HOJA</span></button>
    </nav>

    <script>
        const graphics = {
            '{{VERT}}': 'p-verticals', '{{INCL}}': 'p-slanted', '{{GUION}}': 'p-dash', '{{ALMENA}}': 'p-square', '{{ZIGZAG}}': 'p-zig',
            '{{L_SHAPE}}': 'p-l', '{{U_SHAPE}}': 'p-u', '{{ARCH}}': 'p-arch', '{{C_SHAPE}}': 'p-c', '{{C_REV}}': 'p-c-rev',
            '{{CIRCLE}}': 'p-circle', '{{J_HOOK}}': 'p-j', '{{BUCLE_E}}': 'p-e', '{{BUCLE_L}}': 'p-loop-l',
            '{{OLAS}}': 'p-waves', '{{MUELLE}}': 'p-spring', '{{ESPIRAL}}': 'p-swirl', '{{ROMBOS}}': 'p-diamonds'
        };

        const categories = {
            rectos: ['{{VERT}}', '{{INCL}}', '{{GUION}}', '{{ALMENA}}', '{{ZIGZAG}}', '{{L_SHAPE}}'],
            curvas: ['{{U_SHAPE}}', '{{ARCH}}', '{{C_SHAPE}}', '{{C_REV}}', '{{CIRCLE}}', '{{J_HOOK}}'],
            bucles: ['{{BUCLE_E}}', '{{BUCLE_L}}', '{{OLAS}}', '{{MUELLE}}', '{{ESPIRAL}}', '{{ROMBOS}}'],
            mix: Object.keys(graphics),
            texto: ["Aa Bb Cc Dd Ee", "Ff Gg Hh Ii Jj", "Kk Ll Mm Nn √ë√±", "Oo Pp Qq Rr Ss", "Tt Uu Vv Ww Xx", "Yy Zz 0 1 2 3 4"]
        };

        let selectedColor = '#000000'; 
        const MAX_LINES_SAFE = 13; 

        // --- RENDER LOGIC ---
        const els = {
            input: document.getElementById('inputText'),
            sheet: document.getElementById('sheet'),
            container: document.getElementById('linesContainer'),
            headerTitle: document.getElementById('headerTitleDisplay'),
            studentName: document.getElementById('studentNameDisplay'),
            schoolInput: document.getElementById('schoolName'),
            studentInput: document.getElementById('studentName'),
            counter: document.getElementById('lineCounter'),
            opacity: document.getElementById('opacityRange'),
            size: document.getElementById('sizeRange'),
            paper: document.getElementById('paperSelect'),
            font: document.getElementById('fontSelect'),
            opacityVal: document.getElementById('opacityVal'),
            sizeVal: document.getElementById('sizeVal')
        };

        function render() {
            saveState();

            els.headerTitle.textContent = els.schoolInput.value || "Caligraf√≠a";
            els.studentName.textContent = els.studentInput.value ? `Alumno: ${els.studentInput.value}` : "Alumno: _________________";
            els.container.className = `w-full relative flex-grow ${els.paper.value || 'pattern-montessori'}`;

            const sizePx = els.size.value;
            const sizePt = Math.round(sizePx * 0.75);
            els.opacityVal.textContent = els.opacity.value + '%';
            els.sizeVal.textContent = `${sizePx}px (‚âà${sizePt}pt)`;

            const mode = document.querySelector('input[name="practiceMode"]:checked').value;
            const lines = els.input.value.split('\n');
            let usedLines = 0;
            
            els.container.innerHTML = ''; 

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line && i === lines.length - 1) continue; 

                let cost = 1;
                if (mode === 'plana') cost = 2;
                if (mode === 'progressive') cost = 3;

                if (usedLines + cost > MAX_LINES_SAFE) break;

                const isGraphic = !!graphics[line];
                
                if (mode === 'simple') {
                    createRow(line, els.opacity.value / 100, isGraphic);
                } else if (mode === 'plana') {
                    createRow(line, els.opacity.value / 100, isGraphic);
                    createRow(''); 
                } else if (mode === 'progressive') {
                    createRow(line, 1, isGraphic); 
                    createRow(line, 0.2, isGraphic); 
                    createRow(''); 
                }
                
                usedLines += cost;
            }

            els.counter.textContent = `${usedLines} / ${MAX_LINES_SAFE}`;
            els.counter.className = usedLines >= MAX_LINES_SAFE ? "text-xs font-mono font-bold text-red-400" : "text-xs font-mono font-bold text-green-400";
        }

        function createRow(content, opacity = 1, isPattern = false) {
            const div = document.createElement('div');
            
            if (isPattern) {
                div.className = 'svg-row';
                div.innerHTML = `<div class="svg-pattern ${graphics[content]}" style="opacity:${opacity}; background-color:${selectedColor}"></div>`;
            } else if (!content) {
                div.className = 'text-row';
                div.innerHTML = '&nbsp;';
            } else {
                const font = els.font.value === 'font-cursive' ? 'font-cursive' : 'font-print';
                const span = document.createElement('span');
                span.className = `text-row ${font}`;
                span.textContent = content;
                span.style.color = selectedColor;
                span.style.opacity = opacity;
                span.style.fontSize = els.size.value + 'px';
                div.appendChild(span);
            }
            els.container.appendChild(div);
        }

        function addGraphic(tag) {
            const currentLines = els.input.value.split('\n').filter(l => l).length;
            const mode = document.querySelector('input[name="practiceMode"]:checked').value;
            const cost = mode === 'progressive' ? 3 : (mode === 'plana' ? 2 : 1);
            if ((currentLines + 1) * cost > MAX_LINES_SAFE) { alert("¬°Hoja llena!"); return; }
            els.input.value += (els.input.value ? '\n' : '') + tag;
            render();
        }

        function fillPage(type) {
            const mode = document.querySelector('input[name="practiceMode"]:checked').value;
            let cost = mode === 'progressive' ? 3 : (mode === 'plana' ? 2 : 1);
            let availableSlots = Math.floor(MAX_LINES_SAFE / cost);
            let content = "";
            let list = categories[type];
            for(let i=0; i<availableSlots; i++) {
                content += list[i % list.length] + (i < availableSlots-1 ? '\n' : '');
            }
            els.input.value = content;
            render();
            if(window.innerWidth < 768) switchTab('preview');
        }

        function fillRemaining() {
            const mode = document.querySelector('input[name="practiceMode"]:checked').value;
            const cost = mode === 'progressive' ? 3 : (mode === 'plana' ? 2 : 1);
            const lines = els.input.value.split('\n').filter(x => x.trim() !== '');
            const usedSlots = lines.length;
            const maxSlots = Math.floor(MAX_LINES_SAFE / cost);
            const remaining = maxSlots - usedSlots;
            if (remaining <= 0) { alert("La hoja ya est√° llena."); return; }
            for(let i=0; i<remaining; i++) els.input.value += '\n{{OLAS}}';
            render();
        }

        function resetAll() { els.input.value = ''; render(); }
        function setColor(c) { selectedColor = c; render(); }
        function switchTab(t) {
            if(t==='config') { document.getElementById('panelConfig').classList.remove('hidden'); document.getElementById('panelPreview').classList.add('hidden'); document.getElementById('panelPreview').classList.remove('flex'); }
            else { document.getElementById('panelConfig').classList.add('hidden'); document.getElementById('panelPreview').classList.remove('hidden'); document.getElementById('panelPreview').classList.add('flex'); }
        }

        function saveState() {
            const state = {
                text: els.input.value, size: els.size.value, opacity: els.opacity.value,
                font: els.font.value, paper: els.paper.value, school: els.schoolInput.value,
                student: els.studentInput.value, mode: document.querySelector('input[name="practiceMode"]:checked').value,
                color: selectedColor
            };
            localStorage.setItem('caligrafiaState', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('caligrafiaState');
            if (saved) {
                const state = JSON.parse(saved);
                if(state.text) els.input.value = state.text;
                if(state.size) els.size.value = state.size;
                if(state.opacity) els.opacity.value = state.opacity;
                if(state.font) els.font.value = state.font;
                if(state.paper) els.paper.value = state.paper;
                if(state.school) els.schoolInput.value = state.school;
                if(state.student) els.studentInput.value = state.student;
                if(state.color) selectedColor = state.color;
                if(state.mode) { document.querySelector(`input[name="practiceMode"][value="${state.mode}"]`).checked = true; }
            }
        }

        document.querySelectorAll('input, select, textarea').forEach(el => el.addEventListener('input', render));
        loadState();
        if(!els.input.value) fillPage('mix');
        if(window.innerWidth < 768) switchTab('preview');
        else { document.getElementById('panelConfig').classList.remove('hidden'); document.getElementById('panelPreview').classList.remove('hidden'); }
        render();
    </script>
</body>
</html>


