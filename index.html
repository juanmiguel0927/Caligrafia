<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Entrenador Caligraf√≠a v18</title>
    
    <!-- FUENTES -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* --- ESTILOS DE IMPRESI√ìN --- */
        @media print {
            @page { margin: 0; size: letter; }
            body { background: white; padding: 0; margin: 0; }
            .no-print, #mobileTabs, #printFloatBtn { display: none !important; }
            #panelConfig { display: none !important; }
            #panelPreview { display: block !important; margin: 0 !important; padding: 0 !important; height: auto !important; overflow: visible !important;}
            
            .sheet { 
                box-shadow: none !important; 
                margin: 0 !important; 
                width: 8.5in !important;
                height: 11in !important;
                page-break-after: always;
                border: none !important;
                transform: none !important;
            }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        /* --- HOJA CARTA --- */
        .sheet {
            width: 8.5in;
            height: 11in;
            background-color: white;
            position: relative;
            padding: 0.5in 0.8in;
            box-sizing: border-box;
            margin: 0 auto;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* PATRONES DE FONDO */
        .pattern-montessori {
            background-image: repeating-linear-gradient(to bottom, transparent 0px, transparent 19px, #bfdbfe 20px, transparent 21px, transparent 39px, #bfdbfe 40px, transparent 41px, transparent 59px, #e5e7eb 60px);
            background-size: 100% 60px;
            background-position: 0 1.2in; 
        }
        .pattern-lines {
            background-image: repeating-linear-gradient(to bottom, transparent 0px, transparent 59px, #9ca3af 60px);
            background-size: 100% 60px;
            background-position: 0 1.2in;
        }
        .pattern-grid {
            background-image: linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 1.2in;
        }

        /* --- RENGLONES --- */
        .text-row {
            width: 100%;
            position: relative;
            white-space: pre-wrap; 
            word-wrap: break-word;
            min-height: 60px;
            line-height: 60px;
            display: block;
            box-sizing: border-box;
            padding-top: 10px;
        }
        
        .font-cursive { font-family: 'Dancing Script', cursive; padding-left: 8px; }
        .font-print { font-family: 'Lexend', sans-serif; letter-spacing: 1px; }

        /* --- SVG CONFIG --- */
        .svg-row { height: 60px; width: 100%; overflow: hidden; display: flex; align-items: flex-end; margin-bottom: 0; }
        .svg-pattern { 
            width: 100%; height: 60px; display: block; 
            -webkit-mask-repeat: repeat-x; mask-repeat: repeat-x; 
            -webkit-mask-position: bottom left; mask-position: bottom left;
            background-color: currentColor; 
        }

        /* DEFINICIONES SVG (Masks) */
        .p-verticals { -webkit-mask-size: 15px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='15' height='60' viewBox='0 0 15 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='7.5' y1='15' x2='7.5' y2='45' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-slanted { -webkit-mask-size: 15px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='15' height='60' viewBox='0 0 15 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='12' y1='15' x2='3' y2='45' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-dash { -webkit-mask-size: 25px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='25' height='60' viewBox='0 0 25 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='2' y1='30' x2='23' y2='30' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-square { -webkit-mask-size: 30px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='30' height='60' viewBox='0 0 30 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,45 L0,20 L15,20 L15,45 L30,45' fill='none' stroke='black' stroke-width='1.5' stroke-linejoin='round'/%3E%3C/svg%3E"); }
        .p-zig { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,45 L10,15 L20,45' fill='none' stroke='black' stroke-width='1.5' stroke-linejoin='round'/%3E%3C/svg%3E"); }
        .p-u { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2,20 Q10,55 18,20' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-arch { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2,45 Q10,10 18,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-c { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18,20 Q2,32.5 18,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-c-rev { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2,20 Q18,32.5 2,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-circle { -webkit-mask-size: 25px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='25' height='60' viewBox='0 0 25 60' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='12.5' cy='32.5' r='8' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-l { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5,15 L5,40 Q5,45 15,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-j { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15,20 L15,45 Q15,55 5,50' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-e { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,45 Q5,45 5,35 Q5,25 10,25 Q15,25 15,35 Q15,45 20,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-loop-l { -webkit-mask-size: 20px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='20' height='60' viewBox='0 0 20 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,45 Q10,45 10,10 Q10,10 20,45' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-waves { -webkit-mask-size: 30px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='30' height='60' viewBox='0 0 30 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,35 Q7.5,20 15,35 T30,35' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-spring { -webkit-mask-size: 15px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='15' height='60' viewBox='0 0 15 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,40 Q7.5,10 15,40' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-swirl { -webkit-mask-size: 40px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='40' height='60' viewBox='0 0 40 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5,40 C5,25 35,25 35,40 C35,50 15,50 15,35 C15,30 25,30 25,35' fill='none' stroke='black' stroke-width='1.5'/%3E%3C/svg%3E"); }
        .p-diamonds { -webkit-mask-size: 30px 60px; -webkit-mask-image: url("data:image/svg+xml,%3Csvg width='30' height='60' viewBox='0 0 30 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,32.5 L15,15 L30,32.5 L15,50 L0,32.5' fill='none' stroke='black' stroke-width='1.5' stroke-linejoin='round'/%3E%3C/svg%3E"); }

        /* Estilos UI */
        .btn-exercise { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; padding: 4px; height: 50px; transition: all 0.2s; border-radius: 6px; }
        .btn-preview { width: 100%; height: 25px; display: block; -webkit-mask-repeat: repeat-x; mask-repeat: repeat-x; -webkit-mask-position: center; mask-position: center; background-color: #e5e7eb; margin-bottom: 2px; }
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }

        @media (max-width: 768px) {
            .sheet { transform: scale(0.42); transform-origin: top left; margin-bottom: -130%; }
            #previewContainer { height: calc(100vh - 80px); background: #111827; padding: 10px; display: flex; justify-content: center; overflow: auto; }
            #panelConfig { background-color: #0f172a; color: white; } 
        }
        @media (min-width: 769px) {
            #mobileTabs { display: none; }
            #panelConfig { display: flex !important; }
            #panelPreview { display: flex !important; }
            .sheet { transform: none; margin-bottom: 20px; }
        }
    </style>
</head>
<body class="bg-gray-100 h-screen overflow-hidden flex flex-col md:flex-row font-sans">

    <!-- PANEL LATERAL -->
    <aside id="panelConfig" class="w-full md:w-[420px] bg-gray-900 text-gray-100 shadow-xl z-20 flex flex-col h-full md:h-screen overflow-y-auto border-r border-gray-700 hidden md:flex relative">
        <div class="p-4 space-y-4 pb-24 md:pb-5">
            <div class="border-b border-gray-700 pb-2 flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold text-blue-400">‚úçÔ∏è Caligraf√≠a Pro</h2>
                    <p class="text-[10px] text-gray-400">by Juan Miguel Rios Redondo</p>
                </div>
                <button onclick="clearText()" class="text-xs bg-red-900/50 hover:bg-red-800 text-red-200 px-3 py-1 rounded border border-red-800">Limpiar</button>
            </div>

            <!-- ENCABEZADO PERSONALIZABLE -->
            <div class="bg-gray-800 p-3 rounded-lg border border-gray-700 space-y-2">
                <label class="text-[10px] text-gray-400 uppercase font-bold">Datos de la Hoja</label>
                <div class="grid grid-cols-2 gap-2">
                    <input type="text" id="schoolName" placeholder="Colegio / Materia" class="bg-gray-900 border border-gray-600 text-gray-300 text-xs rounded p-2 focus:border-blue-500 outline-none">
                    <input type="text" id="studentName" placeholder="Nombre Alumno" class="bg-gray-900 border border-gray-600 text-gray-300 text-xs rounded p-2 focus:border-blue-500 outline-none">
                </div>
            </div>

            <!-- MODO DE EJERCICIO -->
            <div class="bg-gray-800 p-3 rounded-lg border border-gray-700 space-y-3">
                <label class="text-[10px] text-gray-400 uppercase font-bold">Modo de Pr√°ctica</label>
                <div class="grid grid-cols-3 gap-2 text-xs">
                    <label class="flex flex-col items-center cursor-pointer">
                        <input type="radio" name="practiceMode" value="simple" class="mb-1 accent-blue-500" checked onchange="render()">
                        <span class="text-gray-300">Simple</span>
                    </label>
                    <label class="flex flex-col items-center cursor-pointer">
                        <input type="radio" name="practiceMode" value="plana" class="mb-1 accent-blue-500" onchange="render()">
                        <span class="text-gray-300">Alterno</span>
                    </label>
                    <label class="flex flex-col items-center cursor-pointer" title="Modelo -> Trazar -> Intentar">
                        <input type="radio" name="practiceMode" value="progressive" class="mb-1 accent-blue-500" onchange="render()">
                        <span class="text-blue-300 font-bold">Progresivo</span>
                    </label>
                </div>

                <div class="border-t border-gray-700 pt-2">
                    <label class="text-[10px] text-gray-400 uppercase font-bold block mb-2">Color Tinta</label>
                    <div class="flex gap-2 justify-center">
                        <button onclick="setColor('black')" class="w-6 h-6 rounded-full bg-black border border-gray-500 ring-2 ring-transparent focus:ring-white"></button>
                        <button onclick="setColor('#2563eb')" class="w-6 h-6 rounded-full bg-blue-600 border border-gray-500 ring-2 ring-transparent focus:ring-white"></button>
                        <button onclick="setColor('#dc2626')" class="w-6 h-6 rounded-full bg-red-600 border border-gray-500 ring-2 ring-transparent focus:ring-white"></button>
                        <button onclick="setColor('#9ca3af')" class="w-6 h-6 rounded-full bg-gray-400 border border-gray-500 ring-2 ring-transparent focus:ring-white" title="L√°piz"></button>
                    </div>
                </div>
            </div>

            <!-- GENERADORES -->
            <div class="bg-gray-800 p-3 rounded-lg border border-gray-700">
                <label class="text-[10px] text-gray-400 uppercase font-bold block mb-2">Generar Rutina Completa</label>
                <div class="grid grid-cols-5 gap-2">
                    <button onclick="fillPage('rectos')" class="flex flex-col items-center justify-center p-2 bg-blue-900/30 hover:bg-blue-800 border border-blue-800 rounded transition"><span class="text-lg">üìè</span><span class="text-[9px] mt-1 text-blue-200">Rectos</span></button>
                    <button onclick="fillPage('curvas')" class="flex flex-col items-center justify-center p-2 bg-green-900/30 hover:bg-green-800 border border-green-800 rounded transition"><span class="text-lg">d o</span><span class="text-[9px] mt-1 text-green-200">Curvas</span></button>
                    <button onclick="fillPage('bucles')" class="flex flex-col items-center justify-center p-2 bg-orange-900/30 hover:bg-orange-800 border border-orange-800 rounded transition"><span class="text-lg">‚û∞</span><span class="text-[9px] mt-1 text-orange-200">Bucles</span></button>
                    <button onclick="fillPage('mix')" class="flex flex-col items-center justify-center p-2 bg-purple-900/30 hover:bg-purple-800 border border-purple-800 rounded transition"><span class="text-lg">üîÄ</span><span class="text-[9px] mt-1 text-purple-200">Mix</span></button>
                    <button onclick="fillPage('texto')" class="flex flex-col items-center justify-center p-2 bg-gray-700 hover:bg-gray-600 border border-gray-600 rounded transition"><span class="text-lg">üìù</span><span class="text-[9px] mt-1 text-gray-200">Texto</span></button>
                </div>
            </div>

            <!-- EJERCICIOS MANUALES -->
            <details class="group bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
                <summary class="p-2 font-bold text-[10px] uppercase text-blue-300 bg-gray-800 hover:bg-gray-700 flex justify-between items-center select-none">1. Rectos<span class="transform group-open:rotate-180 transition-transform">‚ñº</span></summary>
                <div class="p-2 grid grid-cols-4 gap-2 bg-gray-900/50">
                    <button onclick="addGraphic('{{VERT}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-verticals"></span>||||</button>
                    <button onclick="addGraphic('{{INCL}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-slanted"></span>////</button>
                    <button onclick="addGraphic('{{GUION}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-dash"></span>----</button>
                    <button onclick="addGraphic('{{ALMENA}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-square"></span>Castillo</button>
                    <button onclick="addGraphic('{{ZIGZAG}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-zig"></span>ZigZag</button>
                    <button onclick="addGraphic('{{L_SHAPE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-l"></span>L L L</button>
                </div>
            </details>

            <details class="group bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
                <summary class="p-2 font-bold text-[10px] uppercase text-green-300 bg-gray-800 hover:bg-gray-700 flex justify-between items-center select-none">2. Curvas<span class="transform group-open:rotate-180 transition-transform">‚ñº</span></summary>
                <div class="p-2 grid grid-cols-4 gap-2 bg-gray-900/50">
                    <button onclick="addGraphic('{{U_SHAPE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-u"></span>U U U</button>
                    <button onclick="addGraphic('{{ARCH}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-arch"></span>Arcos</button>
                    <button onclick="addGraphic('{{C_SHAPE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-c"></span>C C C</button>
                    <button onclick="addGraphic('{{C_REV}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-c-rev"></span>C Inv.</button>
                    <button onclick="addGraphic('{{CIRCLE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-circle"></span>ooo</button>
                    <button onclick="addGraphic('{{J_HOOK}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-j"></span>J J J</button>
                </div>
            </details>

            <details class="group bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
                <summary class="p-2 font-bold text-[10px] uppercase text-orange-300 bg-gray-800 hover:bg-gray-700 flex justify-between items-center select-none">3. Bucles<span class="transform group-open:rotate-180 transition-transform">‚ñº</span></summary>
                <div class="p-2 grid grid-cols-4 gap-2 bg-gray-900/50">
                    <button onclick="addGraphic('{{BUCLE_E}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-e"></span>elelel</button>
                    <button onclick="addGraphic('{{BUCLE_L}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-loop-l"></span>Alto</button>
                    <button onclick="addGraphic('{{OLAS}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-waves"></span>Olas</button>
                    <button onclick="addGraphic('{{MUELLE}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-spring"></span>Muelle</button>
                    <button onclick="addGraphic('{{ESPIRAL}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-swirl"></span>Espiral</button>
                    <button onclick="addGraphic('{{ROMBOS}}')" class="btn-exercise bg-gray-800 border border-gray-600 hover:bg-gray-700"><span class="btn-preview p-diamonds"></span>Rombos</button>
                </div>
            </details>

            <!-- INPUT MANUAL -->
            <div>
                 <textarea id="inputText" rows="2" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none font-mono text-gray-200" placeholder="Escribe aqu√≠..."></textarea>
            </div>

            <!-- AJUSTES T√âCNICOS -->
            <div class="bg-gray-800 p-3 rounded-lg border border-gray-700 space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-[10px] text-gray-400 uppercase font-bold">Opacidad</label>
                            <span id="opacityVal" class="text-[10px] font-mono text-blue-300">30%</span>
                        </div>
                        <input type="range" id="opacityRange" min="10" max="100" value="30" class="w-full h-1 bg-gray-600 rounded accent-blue-400">
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-[10px] text-gray-400 uppercase font-bold">Tama√±o</label>
                            <span id="sizeVal" class="text-[10px] font-mono text-blue-300">30px</span>
                        </div>
                        <input type="range" id="sizeRange" min="16" max="80" value="30" class="w-full h-1 bg-gray-600 rounded accent-blue-400">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2 mt-2">
                     <select id="paperSelect" class="w-full bg-gray-900 border border-gray-600 text-gray-300 rounded p-2 text-xs">
                        <option value="pattern-montessori">Montessori</option>
                        <option value="pattern-lines">Rayado</option>
                        <option value="pattern-grid">Cuadr√≠cula</option>
                    </select>
                    <select id="fontSelect" class="w-full bg-gray-900 border border-gray-600 text-gray-300 rounded p-2 text-xs">
                        <option value="font-cursive">Cursiva</option>
                        <option value="font-print">Imprenta</option>
                    </select>
                </div>
            </div>

            <!-- FOOTER CON CR√âDITOS -->
            <div class="mt-4 pt-4 border-t border-gray-700 text-center">
                <p class="text-[10px] text-gray-500">Desarrollado por <strong class="text-gray-400">Juan Miguel Rios Redondo</strong></p>
            </div>
        </div>
    </aside>

    <!-- PREVIEW -->
    <main id="panelPreview" class="flex-1 bg-gray-800 h-full overflow-hidden flex flex-col relative hidden md:flex">
        <div class="md:hidden bg-gray-900 text-white p-2 text-center text-xs font-bold uppercase tracking-widest shadow z-10">Vista Previa</div>
        <div id="previewContainer" class="flex-1 w-full flex justify-center p-0 md:p-8 overflow-auto">
            <div id="sheet" class="sheet pattern-montessori shadow-2xl origin-top">
                <!-- CONTENIDO DE LA HOJA -->
                <div class="flex-grow">
                    <div class="flex flex-col items-center border-b-2 border-gray-800 pb-2 mb-4 h-[25mm] justify-end">
                        <h1 id="headerTitleDisplay" class="text-xl font-bold text-gray-800 uppercase tracking-wide font-sans w-full text-center">Caligraf√≠a</h1>
                        <div class="w-full flex justify-between text-sm text-gray-500 mt-1 font-mono">
                            <span id="studentNameDisplay">Alumno: _________________</span>
                            <span>Fecha: _______</span>
                        </div>
                    </div>
                    <div id="linesContainer" class="w-full"></div>
                </div>
                
                <!-- PIE DE P√ÅGINA IMPRESO (CR√âDITO) -->
                <div class="mt-auto pt-2 border-t border-gray-300 text-center">
                    <p class="text-[8px] text-gray-400 font-sans">Material educativo creado con el Entrenador de Caligraf√≠a de Juan Miguel Rios Redondo</p>
                </div>
            </div>
        </div>
        <button id="printFloatBtn" onclick="window.print()" class="absolute bottom-24 right-6 md:bottom-10 md:right-10 bg-blue-600 text-white p-4 rounded-full shadow-lg z-50 hover:bg-blue-500 transition-all transform hover:scale-110 border-2 border-white">üñ®Ô∏è</button>
    </main>

    <!-- TABS M√ìVIL -->
    <nav id="mobileTabs" class="fixed bottom-0 w-full bg-gray-900 border-t border-gray-800 flex justify-around py-2 z-50 shadow-lg md:hidden h-16">
        <button onclick="switchTab('config')" id="tabConfig" class="flex flex-col items-center justify-center text-blue-400 w-1/2"><span class="text-xl mb-1">üõ†Ô∏è</span><span class="text-[10px] font-bold">EDITOR</span></button>
        <button onclick="switchTab('preview')" id="tabPreview" class="flex flex-col items-center justify-center text-gray-400 w-1/2"><span class="text-xl mb-1">üìÑ</span><span class="text-[10px] font-bold">HOJA</span></button>
    </nav>

    <script>
        const graphics = {
            '{{VERT}}': 'p-verticals', '{{INCL}}': 'p-slanted', '{{GUION}}': 'p-dash', '{{ALMENA}}': 'p-square', '{{ZIGZAG}}': 'p-zig',
            '{{L_SHAPE}}': 'p-l', '{{U_SHAPE}}': 'p-u', '{{ARCH}}': 'p-arch', '{{C_SHAPE}}': 'p-c', '{{C_REV}}': 'p-c-rev',
            '{{CIRCLE}}': 'p-circle', '{{J_HOOK}}': 'p-j', '{{BUCLE_E}}': 'p-e', '{{BUCLE_L}}': 'p-loop-l',
            '{{OLAS}}': 'p-waves', '{{MUELLE}}': 'p-spring', '{{ESPIRAL}}': 'p-swirl', '{{ROMBOS}}': 'p-diamonds'
        };

        const categories = {
            rectos: ['{{VERT}}', '{{INCL}}', '{{GUION}}', '{{ALMENA}}', '{{ZIGZAG}}', '{{L_SHAPE}}'],
            curvas: ['{{U_SHAPE}}', '{{ARCH}}', '{{C_SHAPE}}', '{{C_REV}}', '{{CIRCLE}}', '{{J_HOOK}}'],
            bucles: ['{{BUCLE_E}}', '{{BUCLE_L}}', '{{OLAS}}', '{{MUELLE}}', '{{ESPIRAL}}', '{{ROMBOS}}'],
            mix: Object.keys(graphics)
        };

        const pangrams = [
            "Aa Bb Cc Dd Ee Ff Gg Hh",
            "Ii Jj Kk Ll Mm Nn √ë√± Oo",
            "Pp Qq Rr Ss Tt Uu Vv Ww",
            "Xx Yy Zz 1 2 3 4 5 6 7 8 9 0",
            "El veloz murci√©lago hind√∫ com√≠a feliz cardillo y kiwi.",
            "La cig√ºe√±a tocaba el saxof√≥n detr√°s del palenque de paja.",
            "Jovencillo emponzo√±ado de whisky: ¬°qu√© figurota exhibe!"
        ];

        let selectedColor = '#000000'; 

        // --- MANEJO DE ESTADO (PERSISTENCIA) ---
        function saveState() {
            const state = {
                text: els.input.value,
                size: els.size.value,
                opacity: els.opacity.value,
                font: els.font.value,
                paper: els.paper.value,
                school: els.schoolName.value,
                student: els.studentName.value,
                mode: document.querySelector('input[name="practiceMode"]:checked').value,
                color: selectedColor
            };
            localStorage.setItem('caligrafiaState', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('caligrafiaState');
            if (saved) {
                const state = JSON.parse(saved);
                if(state.text) els.input.value = state.text;
                if(state.size) els.size.value = state.size;
                if(state.opacity) els.opacity.value = state.opacity;
                if(state.font) els.font.value = state.font;
                if(state.paper) els.paper.value = state.paper;
                if(state.school) els.schoolName.value = state.school;
                if(state.student) els.studentName.value = state.student;
                if(state.color) selectedColor = state.color;
                if(state.mode) {
                    const radio = document.querySelector(`input[name="practiceMode"][value="${state.mode}"]`);
                    if(radio) radio.checked = true;
                }
            }
        }

        // --- TABS LOGIC ---
        function switchTab(tab) {
            const config = document.getElementById('panelConfig');
            const preview = document.getElementById('panelPreview');
            const tConf = document.getElementById('tabConfig');
            const tPrev = document.getElementById('tabPreview');

            if (tab === 'config') {
                config.classList.remove('hidden'); preview.classList.add('hidden'); preview.classList.remove('flex');
                tConf.className = "flex flex-col items-center justify-center text-blue-400 w-1/2";
                tPrev.className = "flex flex-col items-center justify-center text-gray-400 w-1/2";
            } else {
                config.classList.add('hidden'); preview.classList.remove('hidden'); preview.classList.add('flex');
                tPrev.className = "flex flex-col items-center justify-center text-blue-400 w-1/2";
                tConf.className = "flex flex-col items-center justify-center text-gray-400 w-1/2";
            }
        }

        const els = {
            input: document.getElementById('inputText'),
            sheet: document.getElementById('sheet'),
            container: document.getElementById('linesContainer'),
            opacity: document.getElementById('opacityRange'),
            size: document.getElementById('sizeRange'),
            paper: document.getElementById('paperSelect'),
            font: document.getElementById('fontSelect'),
            lblOpacity: document.getElementById('opacityVal'),
            lblSize: document.getElementById('sizeVal'),
            schoolName: document.getElementById('schoolName'),
            studentName: document.getElementById('studentName'),
            headerTitleDisplay: document.getElementById('headerTitleDisplay'),
            studentNameDisplay: document.getElementById('studentNameDisplay')
        };

        function render() {
            saveState();

            els.sheet.className = `sheet shadow-2xl origin-top ${els.paper.value}`;
            
            // Actualizar Encabezado
            els.headerTitleDisplay.textContent = els.schoolName.value || "Caligraf√≠a";
            els.studentNameDisplay.textContent = els.studentName.value ? `Alumno: ${els.studentName.value}` : "Alumno: _________________";

            els.container.innerHTML = '';
            
            const lines = els.input.value.split('\n');
            const opacity = els.opacity.value / 100;
            const sizePx = els.size.value;
            const sizePt = Math.round(sizePx * 0.75);
            els.lblOpacity.innerText = `${els.opacity.value}%`;
            els.lblSize.innerText = `${sizePx}px (‚âà${sizePt}pt)`;
            const fontClass = els.font.value;
            
            // Obtener modo de pr√°ctica
            const mode = document.querySelector('input[name="practiceMode"]:checked').value;

            // Funci√≥n creadora de renglones
            const createRow = (content, overrideOpacity = null, isPattern = false) => {
                const finalOpacity = overrideOpacity !== null ? overrideOpacity : opacity;
                
                if (isPattern) {
                    const div = document.createElement('div');
                    div.className = `svg-row`;
                    div.innerHTML = `<div class="svg-pattern ${graphics[content]}" style="opacity:${finalOpacity}; background-color:${selectedColor}"></div>`;
                    els.container.appendChild(div);
                } else if (content === '') {
                     const div = document.createElement('div'); 
                     div.className = 'text-row'; 
                     div.innerHTML = '&nbsp;';
                     els.container.appendChild(div);
                } else {
                    const span = document.createElement('span');
                    span.textContent = content;
                    span.className = `text-row ${fontClass}`;
                    span.style.color = selectedColor;
                    span.style.opacity = finalOpacity;
                    span.style.fontSize = sizePx + 'px';
                    els.container.appendChild(span);
                }
            };

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const trimmed = line.trim();
                const isGraphic = !!graphics[trimmed];

                if (trimmed === '') {
                    createRow('');
                    continue;
                }

                if (mode === 'simple') {
                    // Modo Normal: 1 l√≠nea tal cual
                    createRow(line, null, isGraphic);
                } 
                else if (mode === 'plana') {
                    // Modo Alterno: L√≠nea -> Espacio
                    createRow(line, null, isGraphic);
                    createRow('');
                } 
                else if (mode === 'progressive') {
                    // Modo Progresivo: Modelo (Oscuro) -> Trazar (Claro) -> Espacio
                    createRow(line, 1.0, isGraphic); // 100% Opacidad
                    createRow(line, 0.25, isGraphic); // 25% Opacidad
                    createRow(''); // Espacio para intentar
                }
            }
        }

        // Llenado inteligente seg√∫n modo
        function fillPage(type) {
            const mode = document.querySelector('input[name="practiceMode"]:checked').value;
            let MAX_LINES = 13; // Base
            
            // Ajustar cantidad seg√∫n modo
            if (mode === 'plana') MAX_LINES = 7;
            if (mode === 'progressive') MAX_LINES = 4; // 3 renglones por √≠tem

            let content = "";
            let items = [];

            if (type === 'texto') {
                for (let i = 0; i < MAX_LINES; i++) {
                    content += pangrams[i % pangrams.length] + (i < MAX_LINES - 1 ? '\n' : '');
                }
            } else {
                items = categories[type];
                for (let i = 0; i < MAX_LINES; i++) {
                    const item = items[i % items.length];
                    content += item + (i < MAX_LINES - 1 ? '\n' : '');
                }
            }

            els.input.value = content;
            render();
            if (window.innerWidth < 768) switchTab('preview');
        }

        function addGraphic(tag) { els.input.value += (els.input.value ? '\n' : '') + tag; render(); }
        function clearText() { els.input.value = ''; render(); }
        function setColor(color) { selectedColor = color; render(); }

        // Eventos
        const inputs = [els.input, els.opacity, els.size, els.paper, els.font, els.schoolName, els.studentName];
        inputs.forEach(el => el.addEventListener('input', render));

        // Init
        loadState(); // Recuperar sesi√≥n previa
        if (!els.input.value) fillPage('mix'); // Si est√° vac√≠o, llenar mix
        
        if (window.innerWidth < 768) switchTab('preview');
        else { document.getElementById('panelConfig').classList.remove('hidden'); document.getElementById('panelPreview').classList.remove('hidden'); }
        
        render();
    </script>
</body>
</html>


